---
title: "Class 10- Halloween mini project"
author: "Rachel Galleta (A16869649)"
format: pdf
toc: TRUE
---


## Background
as it is nearly halloween and the half way point in the quarter lets do a mini project to help us figure out the  best candy!

out come from 538 website and its avalible as CSV file:

## Data export

```{r}
candy<- read.csv("candy-data.csv",row.names=1)
head(candy)
```
```{r}
library(flextable)
flextable::flextable( head(candy, 10) )
```

> Q1. How many different candy types are in this dataset?

```{r}
nrow(candy)
```


>Q2. How many fruity candy types are in the dataset?

```{r}
sum(candy$fruity)
```

my favorite candy winpercent
```{r}
candy["Twix",]$winpercent
```
Q3. What is your favorite candy in the dataset and what is it’s winpercent value?

Q4. What is the winpercent value for “Kit Kat”?
Q5. What is the winpercent value for “Tootsie Roll Snack Bars”?

```{r}
library(dplyr)
candy|> 
filter(rownames(candy)=="twix")|>
select (winpercent)
```

## quick overview 
```{r}
library("skimr")
skim(candy)
skimr::skim(candy)
```

>Q6. Is there any variable/column that looks to be on a different scale to the majority of the other columns in the dataset?

The winpercent is on a 0-100 scale th rest are 0-1 scale.

>Q7. What do you think a zero and one represent for the candy$chocolate column?

That the cnady doesnt contain chocolate 

>Q8. Plot a histogram of winpercent values

```{r}
library(ggplot2)

ggplot(candy)+
  aes(winpercent)+
  geom_histogram(binds=20)
```

>Q9. Is the distribution of winpercent values symmetrical?

```{r}
ggplot(candy)+
  aes(winpercent)+
  geom_density()
```


>Q10. Is the center of the distribution above or below 50%?

```{r}
mean(candy$winpercent)
```
```{r}
summary(candy$winpercent)
```


>Q11. On average is chocolate candy higher or lower ranked than fruit candy?

```{r}
#1. find all chocolate in the candy data set
#2. find their winpercent value 
#3. calculate the mean of these values

#4-6.do the same for the fruity candy 
#7 compare mean winpercents of the chocolate vs fruity 
#8 pick the highest as the winner

choc.inds <-candy$chocolate==1
choc.win<-candy[choc.inds,]$winpercent
choc.mean<- mean(choc.win)
choc.mean

```

```{r}
mean(candy[candy$chocolate==1,]$winpercent)
mean(candy[candy$fruity==1,]$winpercent)
```


```{r}
fruity.inds <-candy$fruity==1
fruity.win<-candy[fruity.inds,]$winpercent
fruity.mean<- mean(fruity.win)
fruity.mean
```

```{r}
candy|>
  filter(chocolate==1)|> 
  select (winpercent)
```

>Q12. Is this difference statistically significant?

```{r}
t.test(choc.win,fruity.win)

```
## Overall Candy Ranking

>Q13. What are the five least liked candy types in this set?

```{r}
candy|>
  arrange(winpercent) |>
  head(5)
```

```{r}
x<-c(5,1,10,4)
#sort(x)
order(x)
#(candy$winpercent)
```

```{r}
ord.ind<-order(candy$winpercent)
head(candy[rev(ord.ind),],5)
```

>Q14. What are the top 5 all time favorite candy types out of this set?

```{r}
candy|>
  arrange(winpercent)|>
  head(5)
```


>Q15. Make a first barplot of candy ranking based on winpercent values. 

```{r}
ggplot(candy)+
  aes(winpercent,rownames(candy))+
  geom_col()

```

>Q16. This is quite ugly, use the reorder() function to get the bars sorted by winpercent?

```{r}
ggplot(candy) +
  aes(x=winpercent,
      y=reorder (rownames(candy), winpercent))+
  geom_col()
```

add some color based on the "type of candy"

```{r}
my_cols<-rep("black",nrow(candy))
my_cols[as.logical(candy$chocolate)]<-"chocolate" 
my_cols[as.logical(candy$fruity)]<-"red"
my_cols[as.logical(candy$bar)]<- "brown"
my_cols
```

```{r}
ggplot(candy) +
  aes(x=winpercent,
      y=reorder (rownames(candy), winpercent))+
  geom_col(fill=my_cols)
```
```{r}
ggplot(candy) + 
  aes(winpercent, reorder(rownames(candy),winpercent)) +
  geom_col(fill=my_cols) 
```


## Winpercent and pricepercent

a plot with both variables/columns winpercent and pricepercent

```{r}
my_cols[as.logical(candy$fruity)]<-"red"

ggplot(candy) +
  aes(winpercent,pricepercent,
      label=row.names(candy))+
  geom_point(col=my_cols)+
  geom_text()


```

```{r}
library(ggrepel)
ggplot(candy) +
  aes(winpercent,pricepercent,
      label=row.names(candy))+
  geom_point(col=my_cols)+
  geom_text_repel(max.overlaps=7)
```

## Exploring the correlation structure 

Now that we’ve explored the dataset a little, we’ll see how the variables interact with one another. We’ll use correlation and view the results with the corrplot package to plot a correlation matrix.

```{r}
library(corrplot)

cij <- cor(candy)
corrplot(cij)
```


## Principal Component Analysis

the function to use is called `prcomp()` with an optional `scale=T/F` argument.

```{r}
pca<- prcomp(candy,scale=TRUE)
summary(pca)
```

our main PCA reults figure:

```{r}
ggplot(pca$x)+
  aes(PC1,PC2,label=rownames(pca$x))+
  geom_point(col=my_cols) +
  geom_text_repel(col=my_cols)

```

we should also examine the variable "loadings" or contributions of the original variables to the new PCs


```{r}
ggplot(pca$rotation)+
  aes(PC1,rownames(pca$rotation))+
  geom_col()
```

```{r}
ggplot(pca$x)+
  aes(PC1,PC2,label=rownames(pca$x))+
  geom_point(col=my_cols) +
  geom_text_repel(col=my_cols)

```

interactive plots can be zooms on and "brushed" over can be made with **plotly**
package. Its output is interactive and will not render to PDF

```{r}
library(plotly)
par(mar=c(8,4,2,2))
barplot(pca$rotation[,1], las=2, ylab="PC1 Contribution")
```

